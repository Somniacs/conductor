name: Upload release archives

on:
  release:
    types: [published]

permissions:
  contents: write

jobs:
  upload-archives:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create tarball
        run: git archive --format=tar.gz --prefix=conductor/ -o conductor.tar.gz HEAD

      - name: Create zip
        run: git archive --format=zip --prefix=conductor/ -o conductor.zip HEAD

      - name: Upload to release
        run: gh release upload "${{ github.event.release.tag_name }}" conductor.tar.gz conductor.zip --clobber
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
